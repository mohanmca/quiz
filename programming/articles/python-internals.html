<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Python Internals Quiz — Notes</title>
  <style>:root{--primary:#1e88e5;--bg:#f7f9fc;--text:#1a1a1a;--muted:#6b7280}*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--bg)}header{background:#fff;border-bottom:1px solid #e5e7eb;position:sticky;top:0;z-index:10}.container{max-width:980px;margin:0 auto;padding:16px}.title{margin:6px 0 2px;font-size:24px;font-weight:800}.subtitle{margin:0 0 12px;color:var(--muted)}.toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:8px}button{background:var(--primary);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}button.secondary{background:#eef2ff;color:#1f2937}button.ghost{background:transparent;color:#1f2937;border:1px solid #e5e7eb}main.container article{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:18px}h2{margin-top:20px}h3{margin-top:16px}p{line-height:1.6}ul{margin-top:8px}code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#0b1020;color:#e5e7eb;padding:1px 4px;border-radius:4px}pre{background:#0b1020;color:#e5e7eb;padding:12px;border-radius:10px;overflow:auto;border:1px solid #111827}pre code{display:block;background:transparent;padding:0}.tok-kw{color:#93c5fd}.tok-str{color:#a7f3d0}.tok-com{color:#9ca3af;font-style:italic}.tok-num{color:#fcd34d}.tok-builtin{color:#fca5a5}.note{background:#fefce8;border:1px solid #fde68a;color:#713f12;padding:12px;border-radius:10px}.tip{background:#ecfdf5;border:1px solid #10b98133;color:#065f46;padding:12px;border-radius:10px}.toc a{color:#2563eb;text-decoration:none}</style>
  <script>function E(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}function H(src){if(!src)return'';const K=[];const keep=h=>(K.push(h),`@@H${K.length-1}@@`);src=src.replace(/('{3}[\s\S]*?'{3}|"{3}[\s\S]*?"{3})/g,m=>keep(`<span class='tok-str'>${E(m)}</span>`));src=src.replace(/'(?:\\.|[^'\\])*'|"(?:\\.|[^"\\])*"/g,m=>keep(`<span class='tok-str'>${E(m)}</span>`));src=src.replace(/#.*/g,m=>keep(`<span class='tok-com'>${E(m)}</span>`));let html=E(src);const KW=['def','return','if','elif','else','for','while','in','not','and','or','class','import','from','as','try','except','finally','with','lambda','True','False','None','pass','break','continue','yield','global','nonlocal','assert','raise','del','is'];html=html.replace(new RegExp(`\\b(${KW.join('|')})\\b`,'g'),"<span class='tok-kw'>$1</span>");const BI=['len','range','print','dict','list','set','tuple','int','str','float','bool','sum','min','max','sorted','enumerate','zip','map','filter'];html=html.replace(new RegExp(`\\b(${BI.join('|')})\\b`,'g'),"<span class='tok-builtin'>$1</span>");html=html.replace(/\b0x[0-9a-fA-F_]+\b|\b\d+(?:\.\d+)?\b/g,"<span class='tok-num'>$&</span>");return html.replace(/@@H(\d+)@@/g,(m,i)=>K[Number(i)])}function apply(){document.querySelectorAll('pre code.language-python').forEach(el=>el.innerHTML=H(el.textContent||''))}window.addEventListener('DOMContentLoaded',apply)</script>
</head><body>
  <header><div class="container">
    <div class="title">Python Internals — CPython Concepts</div>
    <div class="subtitle">Refcount + GC, GIL, dict/layout, MRO/lookup, frames/bytecode, descriptors, and performance hints</div>
    <div class="toolbar">
      <button class="secondary" onclick="window.location.href='../index.html?id=python-internals'">Start Quiz</button>
      <button class="ghost" onclick="window.location.href='../index.html'">Back to Quizzes</button>
    </div>
  </div></header>
  <main class="container"><article>
    <div class="toc"><strong>Contents:</strong>
      <ul>
        <li><a href="#objects">1. Object Model</a></li>
        <li><a href="#refcnt">2. Refcount and GC</a></li>
        <li><a href="#gil">3. GIL & Threads</a></li>
        <li><a href="#dict">4. Dict Internals</a></li>
        <li><a href="#mro">5. MRO & Attribute Lookup</a></li>
        <li><a href="#frames">6. Frames & Bytecode</a></li>
        <li><a href="#slots">7. __slots__ and Memory</a></li>
        <li><a href="#desc">8. Descriptors & getattr</a></li>
        <li><a href="#closure">9. Closures & Cells</a></li>
        <li><a href="#import">10. Import System</a></li>
        <li><a href="#perf">11. Performance Notes</a></li>
      </ul>
    </div>
    <h2 id="objects">1. Object Model</h2>
    <p>Every value is a PyObject with type pointer and refcount; small integers and some strings may be interned.</p>
    <pre><code class="language-python"># Inspect identity and interning behavior (implementation-dependent)
a = 256; b = 256
print(id(a) == id(b))  # often True due to small-int caching

x = 'hello'; y = 'hello'
print(id(x) == id(y))  # may be True due to interning
    </code></pre>
    <h2 id="refcnt">2. Reference Counting and GC</h2>
    <p>CPython uses reference counting with a cyclic GC for container cycles. <code>sys.getrefcount</code> is a debug aid.</p>
    <pre><code class="language-python">import sys, gc

o = object()
print(sys.getrefcount(o))  # includes temporary ref from argument passing

# Demonstrate a reference cycle and GC collection
class Node:
    def __init__(self):
        self.ref = None

a = Node(); b = Node()
a.ref = b; b.ref = a  # cycle
del a, b
unreachable = gc.collect()
print('collected:', unreachable)
    </code></pre>

    <h2 id="gil">3. GIL & Threads</h2>
    <p>The Global Interpreter Lock makes Python bytecode execution single-threaded per process. I/O-bound threads benefit; CPU-bound workloads prefer multiprocessing or native extensions.</p>
    <pre><code class="language-python">import threading, time
c = 0
def work(n):
    global c
    for _ in range(n):
        c += 1  # protected by GIL, but still contended

ts = [threading.Thread(target=work, args=(1_000_00,)) for _ in range(4)]
for t in ts: t.start()
for t in ts: t.join()
print('count =', c)
    </code></pre>

    <h2 id="dict">4. Dict Internals</h2>
    <p>CPython dicts are compact hash tables with insertion-order preservation. Hash randomization mitigates collision attacks.</p>
    <pre><code class="language-python">import sys
d = {f'k{i}': i for i in range(10)}
print(list(d.keys()))          # insertion order
print('size bytes:', sys.getsizeof(d))
    </code></pre>

    <h2 id="mro">5. MRO & Attribute Lookup</h2>
    <p>Lookup order: instance dict → class dict (descriptors first) → bases following C3 MRO.</p>
    <pre><code class="language-python">class A:    
    x = 'A'
class B(A):
    pass
class C(A):
    x = 'C'
class D(B, C):
    pass
print(D.__mro__)
print(D().x)  # 'C'
    </code></pre>
    <h2 id="frames">6. Frames & Bytecode</h2>
    <p>Functions compile to code objects. The VM executes frames holding locals/globals and an evaluation stack. Use <code>dis</code> to inspect bytecode.</p>
    <pre><code class="language-python">import dis
def f(a, b):
    c = a + b
    return c * 2
dis.dis(f)
    </code></pre>

    <h2 id="slots">7. __slots__ and Memory</h2>
    <p><code>__slots__</code> removes the per-instance <code>__dict__</code>, reducing memory and attribute lookup overhead.</p>
    <pre><code class="language-python">class P:
    __slots__ = ('x','y')
    def __init__(self,x,y): self.x=x; self.y=y

p = P(1,2)
# p.__dict__  # AttributeError
    </code></pre>
    <h2 id="desc">8. Descriptors and getattr</h2>
    <p>Descriptors power <code>@property</code>, methods, and many protocols.</p>
    <pre><code class="language-python">class Celsius:
    def __init__(self, c): self._c = float(c)
    @property
    def f(self): return (self._c * 9/5) + 32

o = Celsius(10)
print(o.f)
    </code></pre>
    <h2 id="closure">9. Closures & Cells</h2>
    <p>Closures capture variables by reference in cell objects; <code>nonlocal</code> binds to the nearest enclosing scope.</p>
    <pre><code class="language-python">def outer(x):
    def inner(y):
        return x + y
    return inner

add5 = outer(5)
print(add5(3))  # 8
print(add5.__closure__[0].cell_contents)  # 5
    </code></pre>

    <h2 id="import">10. Import System</h2>
    <p>Modules are loaded by finders/loaders and cached in <code>sys.modules</code>. Top-level code runs at import time.</p>
    <pre><code class="language-python">import sys, importlib
print('cached:', list(sys.modules)[:5])
spec = importlib.util.find_spec('json')
print(spec.name, 'from', spec.origin)
    </code></pre>

    <h2 id="perf">11. Performance Notes</h2>
    <ul>
      <li>Local variables and attribute access dominate cost; avoid repeated lookups in tight loops.</li>
      <li>Prefer comprehensions, builtins in C, and <code>array</code>/<code>memoryview</code> for numeric buffers.</li>
      <li>Use <code>timeit</code> and <code>cProfile</code> to validate assumptions.</li>
    </ul>
    <div class="note">Covers quiz themes: object identity/interning, refcount+GC, descriptors, and memory behavior.</div>
  </article></main>
</body></html>
