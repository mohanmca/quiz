<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Internals Quiz</title>
    <!-- SurveyJS CSS -->
    <link href="https://unpkg.com/survey-core@1.11.5/defaultV2.min.css" rel="stylesheet">
    <!-- Bootstrap CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- SurveyJS and jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://unpkg.com/survey-core@1.11.5/survey.core.min.js"></script>
    <script src="https://unpkg.com/survey-jquery-ui@1.11.5/survey-jquery-ui.min.js"></script>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div id="surveyContainer"></div>
    </div>

    <script>
        // SurveyJS configuration for Python Internals Quiz
        const surveyJson = {
            title: "Python Internals Quiz",
            description: "Test your knowledge of Python internals to prepare for your interview!",
            showProgressBar: "bottom",
            showTimerPanel: "top",
            maxTimeToFinish: 120, // Default 2 minutes for 10 questions (will be updated dynamically)
            maxTimeToFinishPage: 30, // 30 seconds per question
            firstPageIsStarted: true,
            completedHtml: "<h4>You got <b>{correctAnswers}</b> out of <b>{questionCount}</b> correct answers.</h4>",
            completedHtmlOnCondition: [
                { expression: "{correctAnswers} == 0", html: "<h4>Unfortunately, none of your answers are correct. Please review Python internals and try again!</h4>" },
                { expression: "{correctAnswers} == {questionCount}", html: "<h4>Perfect score! You're ready for your Python internals interview!</h4>" }
            ],
            pages: [
                {
                    name: "startPage",
                    elements: [
                        {
                            type: "html",
                            html: "<h4>Welcome to the Python Internals Quiz!</h4><p>Test your knowledge of Python's internal workings. Choose how many questions you want to answer and enter your name below to begin.</p>"
                        },
                        {
                            type: "text",
                            name: "username",
                            title: "Your Name",
                            isRequired: true,
                            placeHolder: "Enter your name"
                        },
                        {
                            type: "dropdown",
                            name: "questionCount",
                            title: "Number of Questions",
                            isRequired: true,
                            choices: [
                                { value: 5, text: "5 Questions (Quick)" },
                                { value: 10, text: "10 Questions (Medium)" },
                                { value: 15, text: "15 Questions (Extended)" },
                                { value: 25, text: "25 Questions (Full Quiz)" }
                            ],
                            defaultValue: 10
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q1",
                            title: "What is the Global Interpreter Lock (GIL) in CPython?",
                            choices: [
                                "A lock that prevents multiple native threads from executing Python bytecodes simultaneously",
                                "A mechanism to optimize memory allocation",
                                "A lock for file I/O operations",
                                "A garbage collection algorithm"
                            ],
                            correctAnswer: "A lock that prevents multiple native threads from executing Python bytecodes simultaneously"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q2",
                            title: "How does Python manage memory for objects?",
                            choices: [
                                "Using reference counting and a cyclic garbage collector",
                                "Using a mark-and-sweep garbage collector only",
                                "Using manual memory management",
                                "Using a stack-based allocator"
                            ],
                            correctAnswer: "Using reference counting and a cyclic garbage collector"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q3",
                            title: "What is the purpose of the __slots__ attribute in a Python class?",
                            choices: [
                                "To define a fixed set of attributes to reduce memory usage",
                                "To enable multiple inheritance",
                                "To mark a class as abstract",
                                "To optimize method calls"
                            ],
                            correctAnswer: "To define a fixed set of attributes to reduce memory usage"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q4",
                            title: "What is the role of the PyObject structure in CPython?",
                            choices: [
                                "It is the base structure for all Python objects",
                                "It handles file operations",
                                "It manages the GIL",
                                "It stores bytecode instructions"
                            ],
                            correctAnswer: "It is the base structure for all Python objects"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q5",
                            title: "How does Python store integers in CPython?",
                            choices: [
                                "As fixed-size 32-bit integers",
                                "As variable-length objects for arbitrary precision",
                                "As 64-bit floating-point numbers",
                                "As strings internally"
                            ],
                            correctAnswer: "As variable-length objects for arbitrary precision"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q6",
                            title: "What is the purpose of the ob_refcnt field in a PyObject?",
                            choices: [
                                "To track the reference count for garbage collection",
                                "To store the object's type",
                                "To manage thread synchronization",
                                "To cache method calls"
                            ],
                            correctAnswer: "To track the reference count for garbage collection"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q7",
                            title: "What happens when a Python object's reference count reaches zero?",
                            choices: [
                                "It is immediately deallocated",
                                "It is moved to a secondary memory pool",
                                "It is marked for garbage collection later",
                                "It becomes immutable"
                            ],
                            correctAnswer: "It is immediately deallocated"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q8",
                            title: "What is the purpose of the interned string mechanism in Python?",
                            choices: [
                                "To reuse immutable string objects for memory efficiency",
                                "To encrypt string data",
                                "To compress strings during storage",
                                "To enable string slicing"
                            ],
                            correctAnswer: "To reuse immutable string objects for memory efficiency"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q9",
                            title: "What is a Python bytecode?",
                            choices: [
                                "Low-level instructions executed by the Python virtual machine",
                                "Source code written in C",
                                "A compressed form of Python scripts",
                                "A format for serializing objects"
                            ],
                            correctAnswer: "Low-level instructions executed by the Python virtual machine"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q10",
                            title: "How does Python's list resizing strategy work?",
                            choices: [
                                "It doubles the capacity when full, with some over-allocation",
                                "It increases by a fixed size of 10 elements",
                                "It uses a linked list internally",
                                "It never resizes"
                            ],
                            correctAnswer: "It doubles the capacity when full, with some over-allocation"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q11",
                            title: "What is the role of the __dict__ attribute in Python objects?",
                            choices: [
                                "It stores an object's attributes as a dictionary",
                                "It defines the object's methods",
                                "It manages memory allocation",
                                "It caches function calls"
                            ],
                            correctAnswer: "It stores an object's attributes as a dictionary"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q12",
                            title: "Why does Python use a cyclic garbage collector?",
                            choices: [
                                "To handle reference cycles that reference counting cannot resolve",
                                "To optimize string interning",
                                "To manage thread locks",
                                "To compress memory usage"
                            ],
                            correctAnswer: "To handle reference cycles that reference counting cannot resolve"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q13",
                            title: "What is the difference between PyPy and CPython?",
                            choices: [
                                "PyPy uses JIT compilation, while CPython is an interpreter",
                                "PyPy is written in C, while CPython is written in Python",
                                "PyPy is slower for numerical computations",
                                "PyPy does not support the GIL"
                            ],
                            correctAnswer: "PyPy uses JIT compilation, while CPython is an interpreter"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q14",
                            title: "What is the purpose of the __mro__ attribute in a Python class?",
                            choices: [
                                "To define the method resolution order for multiple inheritance",
                                "To store the class's memory layout",
                                "To manage object serialization",
                                "To cache method results"
                            ],
                            correctAnswer: "To define the method resolution order for multiple inheritance"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q15",
                            title: "How does Python implement dictionary key hashing?",
                            choices: [
                                "Using a hash function to map keys to indices in a hash table",
                                "Using a binary search tree",
                                "Using a linked list for key storage",
                                "Using a fixed-size array"
                            ],
                            correctAnswer: "Using a hash function to map keys to indices in a hash table"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q16",
                            title: "What is the small integer cache in CPython?",
                            choices: [
                                "A cache of integers from -5 to 256 for performance",
                                "A cache for floating-point numbers",
                                "A cache for large integers",
                                "A cache for string objects"
                            ],
                            correctAnswer: "A cache of integers from -5 to 256 for performance"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q17",
                            title: "What is the purpose of the PyTypeObject structure?",
                            choices: [
                                "To define the behavior and properties of a type in CPython",
                                "To manage memory allocation",
                                "To store bytecode",
                                "To handle file I/O"
                            ],
                            correctAnswer: "To define the behavior and properties of a type in CPython"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q18",
                            title: "How does Python handle function calls internally?",
                            choices: [
                                "Using a stack-based virtual machine",
                                "Using direct C function calls",
                                "Using a queue-based scheduler",
                                "Using inline assembly"
                            ],
                            correctAnswer: "Using a stack-based virtual machine"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q19",
                            title: "What is the purpose of the __new__ method in Python?",
                            choices: [
                                "To create a new instance of a class",
                                "To initialize an object's attributes",
                                "To delete an object",
                                "To copy an object"
                            ],
                            correctAnswer: "To create a new instance of a class"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q20",
                            title: "What happens during Python's import process?",
                            choices: [
                                "The module is compiled to bytecode and executed",
                                "The module is linked to a C library",
                                "The module is copied to memory",
                                "The module is serialized"
                            ],
                            correctAnswer: "The module is compiled to bytecode and executed"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q21",
                            title: "What is the role of the PyFrameObject in CPython?",
                            choices: [
                                "It represents the execution frame for a function call",
                                "It stores the object's attributes",
                                "It manages the GIL",
                                "It handles file operations"
                            ],
                            correctAnswer: "It represents the execution frame for a function call"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q22",
                            title: "Why are Python strings immutable?",
                            choices: [
                                "To enable string interning and optimize memory",
                                "To prevent string slicing",
                                "To simplify garbage collection",
                                "To enforce type safety"
                            ],
                            correctAnswer: "To enable string interning and optimize memory"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q23",
                            title: "What is the purpose of the __init__ method in Python?",
                            choices: [
                                "To initialize an object's attributes after creation",
                                "To create a new instance of a class",
                                "To define a class's method resolution order",
                                "To manage memory allocation"
                            ],
                            correctAnswer: "To initialize an object's attributes after creation"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q24",
                            title: "How does Python handle exceptions internally?",
                            choices: [
                                "Using a stack of exception handlers in the frame object",
                                "Using a global exception table",
                                "Using a separate thread for exceptions",
                                "Using a file-based log"
                            ],
                            correctAnswer: "Using a stack of exception handlers in the frame object"
                        }
                    ]
                },
                {
                    elements: [
                        {
                            type: "radiogroup",
                            name: "q25",
                            title: "What is the purpose of the PyEval_EvalFrameEx function in CPython?",
                            choices: [
                                "To execute a frame's bytecode",
                                "To allocate memory for objects",
                                "To manage the GIL",
                                "To parse Python source code"
                            ],
                            correctAnswer: "To execute a frame's bytecode"
                        }
                    ]
                }
            ]
        };

        // Store all questions for dynamic filtering
        const allQuestions = surveyJson.pages.slice(1); // All questions except start page
        let currentSurvey = null;

        // Initialize SurveyJS with modern API
        function initializeSurvey(questionCount = 10) {
            // Filter questions based on count
            const selectedQuestions = allQuestions.slice(0, questionCount);
            
            // Create survey configuration with filtered questions
            const filteredSurveyJson = {
                ...surveyJson,
                pages: [surveyJson.pages[0], ...selectedQuestions], // Start page + selected questions
                maxTimeToFinish: questionCount * 12, // Adjust timer
                completedHtml: `<h4>You got <b>{correctAnswers}</b> out of <b>${questionCount}</b> correct answers.</h4>`,
                completedHtmlOnCondition: [
                    { expression: "{correctAnswers} == 0", html: "<h4>Unfortunately, none of your answers are correct. Please review Python internals and try again!</h4>" },
                    { expression: `{correctAnswers} == ${questionCount}`, html: "<h4>Perfect score! You're ready for your Python internals interview!</h4>" }
                ]
            };
            
            // Create new survey with filtered questions
            currentSurvey = new Survey.Model(filteredSurveyJson);
            
            // Handle question count changes
            currentSurvey.onValueChanged.add(function(sender, options) {
                if (options.name === "questionCount") {
                    const selectedCount = options.value;
                    // Store current form data
                    const userData = {
                        username: sender.getValue("username"),
                        questionCount: selectedCount
                    };
                    
                    // Reinitialize with new question count
                    $("#surveyContainer").empty();
                    initializeSurvey(selectedCount);
                    
                    // Restore user data
                    currentSurvey.setValue("username", userData.username);
                    currentSurvey.setValue("questionCount", userData.questionCount);
                    
                    // Re-render
                    $("#surveyContainer").Survey({
                        model: currentSurvey
                    });
                }
            });
            
            // Handle survey completion
            currentSurvey.onComplete.add(function(sender) {
                showDetailedResults(sender);
            });
            
            return currentSurvey;
        }

        // Initialize the survey with default 10 questions
        const survey = initializeSurvey(10);
        
        // Function to show detailed results with failed questions
        function showDetailedResults(survey) {
            const data = survey.data;
            const pages = survey.pages.slice(1); // Exclude start page
            let correctCount = 0;
            let totalQuestions = pages.length;
            let failedQuestions = [];
            
            // Analyze each question
            pages.forEach((page, index) => {
                const question = page.elements[0];
                const questionName = question.name;
                const userAnswer = data[questionName];
                const correctAnswer = question.correctAnswer;
                
                if (userAnswer === correctAnswer) {
                    correctCount++;
                } else {
                    failedQuestions.push({
                        number: index + 1,
                        title: question.title,
                        userAnswer: userAnswer || "No answer selected",
                        correctAnswer: correctAnswer,
                        choices: question.choices
                    });
                }
            });
            
            // Generate detailed results HTML
            let resultsHtml = `
                <div class="results-container">
                    <h3>Quiz Results for ${data.username}</h3>
                    <div class="score-summary">
                        <h4>Score: ${correctCount}/${totalQuestions} (${Math.round((correctCount/totalQuestions)*100)}%)</h4>
                    </div>
            `;
            
            if (failedQuestions.length > 0) {
                resultsHtml += `
                    <div class="failed-questions">
                        <h4>Questions You Missed:</h4>
                `;
                
                failedQuestions.forEach(q => {
                    resultsHtml += `
                        <div class="question-review">
                            <h5>Question ${q.number}: ${q.title}</h5>
                            <p><strong>Your Answer:</strong> <span class="wrong-answer">${q.userAnswer}</span></p>
                            <p><strong>Correct Answer:</strong> <span class="correct-answer">${q.correctAnswer}</span></p>
                            <hr>
                        </div>
                    `;
                });
                
                resultsHtml += `</div>`;
            } else {
                resultsHtml += `<p class="perfect-score">🎉 Perfect Score! You got all questions correct!</p>`;
            }
            
            resultsHtml += `
                    <div class="action-buttons">
                        <button onclick="restartQuiz()" class="btn btn-primary">Take Quiz Again</button>
                    </div>
                </div>
                
                <style>
                    .results-container {
                        max-width: 800px;
                        margin: 0 auto;
                        padding: 20px;
                    }
                    .score-summary {
                        background: #f8f9fa;
                        padding: 15px;
                        border-radius: 5px;
                        margin-bottom: 20px;
                        text-align: center;
                    }
                    .question-review {
                        background: #fff;
                        border: 1px solid #dee2e6;
                        padding: 15px;
                        margin-bottom: 15px;
                        border-radius: 5px;
                    }
                    .wrong-answer {
                        color: #dc3545;
                        font-weight: bold;
                    }
                    .correct-answer {
                        color: #28a745;
                        font-weight: bold;
                    }
                    .perfect-score {
                        font-size: 1.2em;
                        color: #28a745;
                        text-align: center;
                        font-weight: bold;
                    }
                    .action-buttons {
                        text-align: center;
                        margin-top: 20px;
                    }
                </style>
            `;
            
            // Replace the survey container with results
            document.getElementById('surveyContainer').innerHTML = resultsHtml;
        }
        
        // Function to restart the quiz
        function restartQuiz() {
            location.reload();
        }
        
        // Render the survey using the jQuery UI renderer
        $("#surveyContainer").Survey({
            model: survey
        });
    </script>
</body>
</html>